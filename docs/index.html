<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>チャットテストサイト</title>
</head>
<body>
  <input id="name" type="text" value="" placeholder="名前"/><br>
  <input id="msg" type="text" value="" placeholder="メッセージ"/> 
  <button id="send" type="button" onclick="sendChat()">送信</button>
  <div id="MSG"></div>
</body>
<script>
ws = new WebSocket("wss://cloud.achex.ca/chsite");

//メッセージ送信
function sendChat(){
  let msgElem = document.getElementById("msg");
  let msg = msgElem.value;
  let name = document.getElementById("name").value;
  msgElem.value = "";
  msg = "<" + name + ">" + msg; 
  ws.send(JSON.stringify({"to": "mine","message": msg}));	
}

//サーバー起動時
ws.onopen = e => {
	ws.send(JSON.stringify({"auth": "mine", "password": "0205"}));
	console.log("起動");
	ws.send(JSON.stringify({"to": "login", "message": "アカウントがログイン中..."}));
}

//切断時
ws.onclosed = e => {
        console.log('closed');
}

//メッセージ受信
ws.onmessage = e => {
  var obj = JSON.parse(e.data);
  Msg = obj.message;
  console.log(Msg);
  var MSG = document.getElementById('MSG');
  if (Msg !== undefined){
  MSG.appendChild(document.createTextNode(Msg));
  MSG.appendChild(document.createElement('br'));
  }
}
</script>
</html>
