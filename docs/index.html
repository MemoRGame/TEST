<!DOCTYPE html>
<html lang="ja">
  <head>
    <title>Hit&Blow 1人用</title>
  </head>
  <body>
    <input type="text" id="name" placeholder="名前">
    <input type="text" id="text" placeholder="メッセージ">
    <input type="button" id="registerButton" value="送信">
    <input type="button" id="remove" value="履歴全削除">
    <div id="MSG"></div>
    <script type="module">
//インポートするための文
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
            import { getDatabase, ref, push, set, onChildAdded, remove, onChildRemoved, onValue } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-database.js"; // 追加
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-analytics.js";
            // TODO: Add SDKs for Firebase products that you want to use
            // https://firebase.google.com/docs/web/setup#available-libraries
          
            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
              apiKey: "AIzaSyALbxISZQW6hx97fFEOH7YkSPHZkHNwq6Y",
              authDomain: "test-6aa38.firebaseapp.com",
              databaseURL: "https://test-6aa38-default-rtdb.asia-southeast1.firebasedatabase.app",
              projectId: "test-6aa38",
              storageBucket: "test-6aa38.firebasestorage.app",
              messagingSenderId: "327819738458",
              appId: "1:327819738458:web:c04cc599a731e1aa238763",
              measurementId: "G-QXNG59XZES"
            };
          
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
            const db = getDatabase(app);

//実際の処理を記述↓↓
        
	//パターン2
    function onClick() {
        const text = document.getElementById('text').value;
        const name = document.getElementById('name').value;
        if (text !== "" && name !== ""){
        const dbRef = ref(db, 'path');

        const currentDate = new Date();

        const year = currentDate.getFullYear();  // 西暦
        const month = currentDate.getMonth() + 1;  // 月 (0-11なので1を足す)  
        const day = currentDate.getDate();  // 日 (1-31)
        const hours = currentDate.getHours();  // 時間 (0-23)
        const minutes = currentDate.getMinutes();  // 分 (0-59)
        const seconds = currentDate.getSeconds();  // 秒 (0-59)
        push(dbRef, {Name: name, Text:text, Year:year, Month:month, Day:day, Hours:hours, Minutes:minutes, Seconds:seconds});
        document.getElementById('text').value = '';
        }
        else {
          alert("名前またはメッセージを入力してください");
        }
        }

    function reset(){
      const text = document.getElementById('text').value;
        const name = document.getElementById('name').value;
        if (name !== ""){
        const dbRef = ref(db, 'path');
        push(dbRef, {Name: name, Text:"remove"});
        document.getElementById('text').value = '';
        }
        else {
          alert("履歴を削除する場合は名前を入力してください")
        }
    }

        onChildAdded(ref(db, 'path'), function (snapshot) {
	let data = snapshot.val();
  var MSG = document.getElementById('MSG');
    if (data.Name !== undefined && data.Text !== undefined && data.Text !== "remove"){
    let msg = "<" + data.Name + ">" + data.Text + " " + data.Year + "/" + data.Month + "/" + data.Day + "/" + data.Hours + ":" + data.Minutes + ":" + data.Seconds;
    MSG.appendChild(document.createTextNode(msg));
    MSG.appendChild(document.createElement('br'));
    }
    else if (data.Name !== undefined && data.Text !== undefined && data.Text == "remove"){
      const dbref = ref(db, "path");
      console.log("remove");
      //ここで削除する必要あり
      remove(dbref);
      MSG.textContent = data.Name + "が履歴を削除しました";
      MSG.appendChild(document.createElement('br'));
    }
});

document.addEventListener('keydown', function(event) {
    if (event.key === 'Enter') {
        onClick();
    }
});


    // ボタンにイベントリスナーを追加
    document.getElementById("registerButton").addEventListener("click", onClick);
    document.getElementById("remove").addEventListener("click", reset);
  </script>
  </body>
</html>
