<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>チャットテストサイト</title>
</head>
<body>
  <input id="name" type="text" value="" placeholder="名前"/><br>
  <input id="msg" type="text" value="" placeholder="メッセージ"/> 
  <button id="send" type="button" onclick="sendChat()">送信</button>
  <div id="MSG"></div>
</body>
<script>
ws = new WebSocket("wss://cloud.achex.ca/testcount");

sendMsg = new Date() + "_" + new Date().getTime();
gotMsg = new Array();
activeUserCount = 0;

ws.onmessage = e => {
	var obj = JSON.parse(e.data);
	if (obj.message == sendMsg) {
		activeUserCount++;
		console.log(activeUserCount);
	} else if (obj.message != undefined && gotMsg.filter(msg => msg = obj.message).length == 0) {
		gotMsg.push(obj.message);
		ws.send(JSON.stringify({"to": "testcount", "message": obj.message}));
	}
}

ws.onopen = e => {
	ws.send(JSON.stringify({"auth": "testcount", "password": "1234"}));
	ws.send(JSON.stringify({"to": "testcount", "message": sendMsg}));
}

ws.onclosed = e => {
console.log('closed');
}
</script>
</html>
